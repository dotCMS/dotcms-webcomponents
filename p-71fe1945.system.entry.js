var __awaiter=this&&this.__awaiter||function(t,e,r,s){function a(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,o){function n(t){try{l(s.next(t))}catch(e){o(e)}}function i(t){try{l(s["throw"](t))}catch(e){o(e)}}function l(t){t.done?r(t.value):a(t.value).then(n,i)}l((s=s.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,n;return n={next:i(0),throw:i(1),return:i(2)},typeof Symbol==="function"&&(n[Symbol.iterator]=function(){return this}),n;function i(t){return function(e){return l([t,e])}}function l(n){if(s)throw new TypeError("Generator is already executing.");while(r)try{if(s=1,a&&(o=n[0]&2?a["return"]:n[0]?a["throw"]||((o=a["return"])&&o.call(a),0):a.next)&&!(o=o.call(a,n[1])).done)return o;if(a=0,o)n=[n[0]&2,o.value];switch(n[0]){case 0:case 1:o=n;break;case 4:r.label++;return{value:n[1],done:false};case 5:r.label++;a=n[1];n=[0];continue;case 7:n=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(n[0]===6||n[0]===2)){r=0;continue}if(n[0]===3&&(!o||n[1]>o[0]&&n[1]<o[3])){r.label=n[1];break}if(n[0]===6&&r.label<o[1]){r.label=o[1];o=n;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(n);break}if(o[2])r.ops.pop();r.trys.pop();continue}n=e.call(t,r)}catch(i){n=[6,i];a=0}finally{s=o=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var s=Array(t),a=0,e=0;e<r;e++)for(var o=arguments[e],n=0,i=o.length;n<i;n++,a++)s[a]=o[n];return s};System.register(["./p-79716aa9.system.js","./p-7e33a862.system.js","./p-526ef7ac.system.js","./p-ede1966e.system.js"],(function(exports){"use strict";var registerInstance,h,Host,getElement,fallbackErrorMessages,DotUploadService,getOriginalStatus,updateStatus,getClassNames,getErrorMessage,getFieldsFromLayout,fieldCustomProcess;return{setters:[function(t){registerInstance=t.r;h=t.h;Host=t.H;getElement=t.g},function(t){fallbackErrorMessages=t.f;DotUploadService=t.D},function(t){getOriginalStatus=t.g;updateStatus=t.u;getClassNames=t.a},function(t){getErrorMessage=t.a;getFieldsFromLayout=t.b;fieldCustomProcess=t.f}],execute:function(){var dotFormCss="dot-form{display:block}dot-form>form label{margin:0;padding:0}dot-form>form dot-form-column>*{display:block;margin:2rem 0}dot-form>form dot-form-column>*:first-child{margin-top:0}dot-form>form dot-form-column>*:last-child{margin-bottom:0}dot-form>form .dot-form__buttons{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:end;justify-content:flex-end}dot-form>form .dot-form__buttons button:last-child{margin-left:1rem}";var SUBMIT_FORM_API_URL="/api/v1/workflow/actions/default/fire/NEW";var DotFormComponent=exports("dot_form",function(){function class_1(t){registerInstance(this,t);this.resetLabel="Reset";this.submitLabel="Submit";this.layout=[];this.variable="";this.status=getOriginalStatus();this.errorMessage="";this.uploadFileInProgress=false;this.fieldsStatus={};this.value={}}class_1.prototype.onValueChange=function(t){var e=this;var r=t.target.tagName;var s=t.detail,a=s.name,o=s.value;var n=fieldCustomProcess[r];if(r==="DOT-BINARY-FILE"&&o){this.uploadFile(t).then((function(t){e.value[a]=t&&t.id}))}else{this.value[a]=n?n(o):o}};class_1.prototype.onStatusChange=function(t){var e=t.detail;this.fieldsStatus[e.name]=e.status;this.status=updateStatus(this.status,{dotTouched:this.getTouched(),dotPristine:this.getStatusValueByName("dotPristine"),dotValid:this.getStatusValueByName("dotValid")})};class_1.prototype.layoutWatch=function(){this.value=this.getUpdateValue()};class_1.prototype.fieldsToShowWatch=function(){this.value=this.getUpdateValue()};class_1.prototype.componentWillLoad=function(){this.value=this.getUpdateValue()};class_1.prototype.render=function(){var t=this;var e=getClassNames(this.status,this.status.dotValid);return h(Host,{class:Object.assign({},e)},h("form",{onSubmit:this.handleSubmit.bind(this)},this.layout.map((function(e){return h("dot-form-row",{row:e,"fields-to-show":t.fieldsToShow})})),h("div",{class:"dot-form__buttons"},h("button",{type:"reset",onClick:function(){return t.resetForm()}},this.resetLabel),h("button",{type:"submit",disabled:!this.status.dotValid||this.uploadFileInProgress},this.submitLabel))),h("dot-error-message",null,this.errorMessage))};class_1.prototype.getStatusValueByName=function(t){return Object.values(this.fieldsStatus).map((function(e){return e[t]})).every((function(t){return t===true}))};class_1.prototype.getTouched=function(){return Object.values(this.fieldsStatus).map((function(t){return t.dotTouched})).includes(true)};class_1.prototype.handleSubmit=function(t){var e=this;t.preventDefault();fetch(SUBMIT_FORM_API_URL,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({contentlet:Object.assign({contentType:this.variable},this.value)})}).then((function(t){return __awaiter(e,void 0,void 0,(function(){var e,r;return __generator(this,(function(s){switch(s.label){case 0:if(!(t.status!==200))return[3,2];r={};return[4,t.text()];case 1:e=(r.message=s.sent(),r.status=t.status,r);throw e;case 2:return[2,t.json()]}}))}))})).then((function(t){var r=t.entity;e.runSuccessCallback(r)})).catch((function(t){var r=t.message,s=t.status;e.errorMessage=getErrorMessage(r)||fallbackErrorMessages[s]}))};class_1.prototype.runSuccessCallback=function(contentlet){var successCallback=this.getSuccessCallback();if(successCallback){return function(){return eval(successCallback)}.call({contentlet:contentlet})}};class_1.prototype.getSuccessCallback=function(){var t=getFieldsFromLayout(this.layout).filter((function(t){return t.variable==="formSuccessCallback"}))[0];return t.values};class_1.prototype.resetForm=function(){var t=this;var e=Array.from(this.el.querySelectorAll("form dot-form-column > *"));e.forEach((function(e){return __awaiter(t,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,e.reset()];case 1:r.sent();return[3,3];case 2:t=r.sent();console.warn(""+e.tagName,t);return[3,3];case 3:return[2]}}))}))}))};class_1.prototype.getUpdateValue=function(){return getFieldsFromLayout(this.layout).filter((function(t){return t.fixed===false})).reduce((function(t,e){var r;var s=e.variable,a=e.defaultValue,o=e.dataType,n=e.values;return Object.assign(Object.assign({},t),(r={},r[s]=a||(o!=="TEXT"?n:null),r))}),{})};class_1.prototype.getMaxSize=function(t){var e=__spreadArrays(t.target.attributes);var r=e.filter((function(t){return t.name==="max-file-length"}))[0];return r&&r.value};class_1.prototype.uploadFile=function(t){var e=this;var r=new DotUploadService;var s=t.detail.value;var a=this.getMaxSize(t);var o=t.target;if(!a||s.size<=a){this.uploadFileInProgress=true;o.errorMessage="";return r.uploadFile(s,a).then((function(t){e.errorMessage="";o.previewImageUrl=t.thumbnailUrl;o.previewImageName=t.fileName;e.uploadFileInProgress=false;return t})).catch((function(t){var r=t.message,s=t.status;o.clearValue();e.uploadFileInProgress=false;o.errorMessage=getErrorMessage(r)||fallbackErrorMessages[s];return null}))}else{o.reset().then((function(){o.errorMessage="File size larger than allowed "+a+" bytes"}));return Promise.resolve(null)}};Object.defineProperty(class_1.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(class_1,"watchers",{get:function(){return{layout:["layoutWatch"],fieldsToShow:["fieldsToShowWatch"]}},enumerable:false,configurable:true});return class_1}());DotFormComponent.style=dotFormCss}}}));