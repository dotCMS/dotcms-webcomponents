import{r as t,c as e,h as i,g as n,H as o}from"./p-ca5d1561.js";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var s,r=(function(t){t.exports=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var e=function(t){return t.innerHTML=""},i=function(t,i,n,o,s,r){o({event:t,query:i instanceof HTMLInputElement?i.value:i.innerHTML,matches:s.matches,results:s.list.map((function(t){return t.value})),selection:s.list.find((function(e){return 13===t.keyCode?e.index===Number(r.getAttribute("data-id")):"mousedown"===t.type?e.index===Number(t.currentTarget.getAttribute("data-id")):void 0}))}),e(n)},n=function(t){return"string"==typeof t?document.querySelector(t):t()},o=function(t){return"<span class=".concat("autoComplete_highlighted",">").concat(t,"</span>")},s=e,r=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i};r.prototype=window.Event.prototype;var l={CustomEventWrapper:"function"==typeof window.CustomEvent&&window.CustomEvent||r,initElementClosestPolyfill:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null})}};return function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i,o,s=t.selector,r=void 0===s?"#autoComplete":s,l=t.data,u=l.key,a=l.src,c=l.cache,h=void 0===c||c,d=t.query,f=t.trigger,p=(f=void 0===f?{}:f).event,v=void 0===p?["input"]:p,m=f.condition,b=void 0!==m&&m,g=t.searchEngine,w=void 0===g?"strict":g,y=t.threshold,x=void 0===y?0:y,E=t.debounce,C=void 0===E?0:E,k=t.resultsList,T=(k=void 0===k?{}:k).render,_=void 0!==T&&T,D=k.container,L=k.position,R=void 0===L?"afterend":L,I=k.element,M=void 0===I?"ul":I,H=k.navigation,q=void 0!==H&&H,z=t.sort,P=void 0!==z&&z,j=t.placeHolder,O=t.maxResults,A=void 0===O?5:O,B=t.resultItem,K=(B=void 0===B?{}:B).content,N=void 0!==K&&K,S=B.element,$=void 0===S?"li":S,F=t.noResults,W=t.highlight,G=void 0!==W&&W,J=t.onSelection,Q=_?(i={container:void 0!==D&&D,destination:k.destination||n(r),position:R,element:M},(o=document.createElement(i.element)).setAttribute("id","autoComplete_list"),i.container&&i.container(o),i.destination.insertAdjacentElement(i.position,o),o):null;this.selector=r,this.data={src:function(){return"function"==typeof a?a():a},key:u,cache:h},this.query=d,this.trigger={event:v,condition:b},this.searchEngine="loose"===w?"loose":"function"==typeof w?w:"strict",this.threshold=x,this.debounce=C,this.resultsList={render:_,view:Q,navigation:q},this.sort=P,this.placeHolder=j,this.maxResults=A,this.resultItem={content:N,element:$},this.noResults=F,this.highlight=G,this.onSelection=J,this.init()}var r,u;return r=e,(u=[{key:"search",value:function(t,e){var i=e.toLowerCase();if("loose"===this.searchEngine){t=t.replace(/ /g,"");for(var n=[],s=0,r=0;r<i.length;r++){var l=e[r];s<t.length&&i[r]===t[s]&&(l=this.highlight?o(l):l,s++),n.push(l)}return s===t.length&&n.join("")}if(i.includes(t))return t=new RegExp("".concat(t),"i").exec(e),this.highlight?e.replace(t,o(t)):e}},{key:"listMatchedResults",value:function(t){var e=this;return new Promise((function(i){var n=[];t.filter((function(t,i){var o=function(o){var s=o?t[o]:t;if(s){var r="function"==typeof e.searchEngine?e.searchEngine(e.queryValue,s):e.search(e.queryValue,s);r&&o?n.push({key:o,index:i,match:r,value:t}):r&&!o&&n.push({index:i,match:r,value:t})}};if(e.data.key){var s=!0,r=!1,l=void 0;try{for(var u,a=e.data.key[Symbol.iterator]();!(s=(u=a.next()).done);s=!0)o(u.value)}catch(c){r=!0,l=c}finally{try{s||null==a.return||a.return()}finally{if(r)throw l}}}else o()}));var o=e.sort?n.sort(e.sort).slice(0,e.maxResults):n.slice(0,e.maxResults);return i({matches:n.length,list:o})}))}},{key:"ignite",value:function(){var t=this,e=n(this.selector);this.placeHolder&&e.setAttribute("placeholder",this.placeHolder);var o=function(n){Promise.resolve(t.data.cache?t.dataStream:t.data.src()).then((function(o){t.dataStream=o,function(n){var o=e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e.value.toLowerCase():e.innerHTML.toLowerCase(),r=t.queryValue=t.query&&t.query.manipulate?t.query.manipulate(o):o,u=t.resultsList.render,a=t.trigger.condition?t.trigger.condition(r):r.length>t.threshold&&r.replace(/ /g,"").length,c=function(t,i){e.dispatchEvent(new l.CustomEventWrapper("autoComplete",{bubbles:!0,detail:{event:t,input:o,query:r,matches:i?i.matches:null,results:i?i.list:null},cancelable:!0}))};if(u){var h=t.resultsList.view;s(h),a?t.listMatchedResults(t.dataStream,n).then((function(o){c(n,o),t.resultsList.render&&(0===o.list.length&&t.noResults?t.noResults():(function(t,e,i){var n=document.createDocumentFragment();e.forEach((function(t,o){var s=document.createElement(i.element);s.setAttribute("data-id",e[o].index),s.setAttribute("class","autoComplete_result"),i.content?i.content(t,s):s.innerHTML=t.match||t,n.appendChild(s)})),t.appendChild(n)}(h,o.list,t.resultItem),t.onSelection&&(t.resultsList.navigation?t.resultsList.navigation(n,e,h,t.onSelection,o):function(t,e,n,o){var s,r=e.childNodes,l=r.length-1,u=void 0,a=function(t){u.classList.remove("autoComplete_selected"),s=1===t?u.nextSibling:u.previousSibling},c=function(t){(u=t).classList.add("autoComplete_selected")};t.onkeydown=function(h){if(r.length>0)switch(h.keyCode){case 38:u?(a(0),c(s||r[l])):c(r[l]);break;case 40:u?(a(1),c(s||r[0])):c(r[0]);break;case 13:u&&i(h,t,e,n,o,u)}},r.forEach((function(s){s.onmousedown=function(s){return i(s,t,e,n,o)}}))}(e,h,t.onSelection,o))))})):c(n)}else!u&&a&&t.listMatchedResults(t.dataStream,n).then((function(t){c(n,t)}))}(n)}))};this.trigger.event.forEach((function(i){var n,s,r;e.addEventListener(i,(n=function(t){return o(t)},s=t.debounce,function(){var t=this,e=arguments;clearTimeout(r),r=setTimeout((function(){return n.apply(t,e)}),s)}))}))}},{key:"init",value:function(){var t=this;this.data.cache?Promise.resolve(this.data.src()).then((function(e){t.dataStream=e,t.ignite()})):this.ignite(),l.initElementClosestPolyfill()}}])&&t(r.prototype,u),e}()}()}(s={path:void 0,exports:{},require:function(){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}}),s.exports);const l=class{constructor(i){t(this,i),this.selection=e(this,"selection",7),this.enter=e(this,"enter",7),this.lostFocus=e(this,"lostFocus",7),this.disabled=!1,this.placeholder="",this.threshold=0,this.maxResults=0,this.debounce=300,this.data=null,this.id="autoComplete"+(new Date).getTime(),this.keyEvent={Enter:this.emitEnter.bind(this),Escape:this.clean.bind(this)}}componentDidLoad(){this.data&&this.initAutocomplete()}render(){return i("input",{autoComplete:"off",disabled:this.disabled||null,id:this.id,onBlur:t=>this.handleBlur(t),onKeyDown:t=>this.handleKeyDown(t),placeholder:this.placeholder||null})}watchThreshold(){this.initAutocomplete()}watchData(){this.initAutocomplete()}watchMaxResults(){this.initAutocomplete()}handleKeyDown(t){const{value:e}=this.getInputElement();e&&this.keyEvent[t.key]&&(t.preventDefault(),this.keyEvent[t.key](e))}handleBlur(t){t.preventDefault(),setTimeout(()=>{document.activeElement.parentElement!==this.getResultList()&&(this.clean(),this.lostFocus.emit(t))},0)}clean(){this.getInputElement().value="",this.cleanOptions()}cleanOptions(){this.getResultList().innerHTML=""}emitselect(t){this.clean(),this.selection.emit(t)}emitEnter(t){t&&(this.clean(),this.enter.emit(t))}getInputElement(){return this.el.querySelector("#"+this.id)}initAutocomplete(){this.clearList(),new r({data:{src:async()=>this.getData()},sort:(t,e)=>t.match<e.match?-1:t.match>e.match?1:0,placeHolder:this.placeholder,selector:"#"+this.id,threshold:this.threshold,searchEngine:"strict",highlight:!0,maxResults:this.maxResults,debounce:this.debounce,resultsList:{container:()=>this.getResultListId(),destination:this.getInputElement(),position:"afterend"},resultItem:({match:t})=>t,onSelection:({event:t,selection:e})=>{t.preventDefault(),this.focusOnInput(),this.emitselect(e.value)}})}clearList(){const t=this.getResultList();t&&t.remove()}focusOnInput(){this.getInputElement().focus()}getResultList(){return this.el.querySelector("#"+this.getResultListId())}getResultListId(){return this.id+"_results_list"}async getData(){const t=this.getInputElement();t.setAttribute("placeholder","Loading...");const e="function"==typeof this.data?await this.data():[];return t.setAttribute("placeholder",this.placeholder||""),e}get el(){return n(this)}static get watchers(){return{threshold:["watchThreshold"],data:["watchData"],maxResults:["watchMaxResults"]}}};l.style="dot-autocomplete input{-webkit-box-sizing:border-box;box-sizing:border-box;width:200px}dot-autocomplete ul{background-color:#fff;list-style:none;margin:0;max-height:300px;overflow:auto;padding:0;position:absolute;width:200px}dot-autocomplete ul li{background-color:#fff;border-top:0;border:solid 1px #ccc;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;padding:0.25rem}dot-autocomplete ul li:first-child{border-top:solid 1px #ccc}dot-autocomplete ul li:focus{background-color:lightyellow;outline:0}dot-autocomplete ul li .autoComplete_highlighted{font-weight:bold}";const u=class{constructor(i){t(this,i),this.remove=e(this,"remove",7),this.label="",this.deleteLabel="Delete",this.disabled=!1}render(){const t=this.label?`${this.deleteLabel} ${this.label}`:null;return i(o,null,i("span",null,this.label),i("button",{type:"button","aria-label":t,disabled:this.disabled,onClick:()=>this.remove.emit(this.label)},this.deleteLabel))}get el(){return n(this)}};u.style="dot-chip span{margin-right:0.25rem}dot-chip button{cursor:pointer}";export{l as dot_autocomplete,u as dot_chip}